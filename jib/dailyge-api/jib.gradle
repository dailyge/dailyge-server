def env = System.getenv("ENV")
def ECR_URI = null
if (env == "prod") {
    ECR_URI = System.getenv("PROD_ECR_URI")
} else {
    ECR_URI = System.getenv("DEV_ECR_URI")
}

if (env == "dev" || env == "prod") {
    jib {
        from {
            image = "openjdk:17-jdk-slim"
        }
        to {
            image = ECR_URI
            credHelper = "ecr-login"
            tags = ["latest", "${project.version}-${System.currentTimeMillis()}"]
        }
        container {
            ports = ["8080"]
            labels = [server: "dailyge-api"]
            environment = [JAVA_OPTIONS: "-Xms512m -Xmx512m"]
            creationTime = "USE_REST_TIMESTAMP"
            allowInsecureRegistries = false
        }
    }
}
